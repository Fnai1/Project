image: mcr.microsoft.com/windows/servercore:ltsc2019

variables:
  CONFIG_NAME: "andreym"
  ARTIFACTS_DIR: "artifacts"
  BUILD_DIR: "$ARTIFACTS_DIR/build"

stages:
  - init
  - build
  - test

init-stage:
  stage: init
  tags:
    - windows
  script:
    - echo "Initializing pipeline"
    - echo "Config: $CONFIG_NAME"
    - mkdir -p "$BUILD_DIR"
  artifacts:
    paths:
      - "$ARTIFACTS_DIR/"
    expire_in: 1 day

build-stage:
  stage: build
  tags:
    - windows
  script:
    - echo "Building configuration: $CONFIG_NAME"
    - echo "Creating CF file..."
    - echo "1C CF File: $CONFIG_NAME" > "$BUILD_DIR/$CONFIG_NAME.cf"
    - echo "Version: 1.0" >> "$BUILD_DIR/$CONFIG_NAME.cf"
    - echo "Build completed"
  artifacts:
    paths:
      - "$BUILD_DIR/*"
    expire_in: 30 days
  only:
    - main
    - develop

test-stage:
  stage: test
  tags:
    - windows
  script:
    - echo "Testing configuration: $CONFIG_NAME"
    - echo "Checking file..."
    - echo "Test passed"
  needs: ["build-stage"]
  only:
    - main
    - develop
