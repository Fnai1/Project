name: 1C CI/CD Simple Test

on: [push, pull_request]

jobs:
  build-and-test:
    runs-on: windows-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Build and test
      shell: pwsh
      run: |
        # Настройка
        $CONFIG_NAME = "andreym"
        $BUILD_DIR = "artifacts/build"
        
        echo "=== 1C CI/CD Pipeline ==="
        echo "Configuration: $CONFIG_NAME"
        
        # Создаем структуру
        New-Item -ItemType Directory -Path $BUILD_DIR -Force
        echo "✓ Directories created"
        
        # Создаем CF файл
        $cfFile = "$BUILD_DIR/$CONFIG_NAME.cf"
        echo "# 1C Configuration File" > $cfFile
        echo "Name: $CONFIG_NAME" >> $cfFile
        echo "Version: 1.0" >> $cfFile
        echo "Date: $(Get-Date -Format "yyyy-MM-dd HH:mm:ss")" >> $cfFile
        echo "✓ CF file created"
        
        # Тестируем
        echo "=== Testing ==="
        if (Test-Path $cfFile) {
          echo "✓ Test passed: File exists"
          echo "File info:"
          Get-Item $cfFile | Format-List Name, Length, LastWriteTime
        } else {
          echo "✗ Test failed"
          exit 1
        }
        
        echo "=== Pipeline completed successfully ==="
